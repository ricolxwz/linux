---
title: 权限
icon: simple/amazoniam
---

## 命令一览

=== "`chmod`"

    **语法**:

    ```
    chmod [-cfvR] mode file
    ```

    **参数说明**:

    mode: 权限设定字串, 格式如下: 

    ```
    [ugoa...][[+-=][rwx]...]
    ```

    其中: 

    - `u`表示该文件的拥有者, `g`表示与该文件的拥有者属于同一个组的用户, `o`表示其他的用户, `a`表示三者皆是
    - `+`表示增加权限, `-`表示取消权限, `=`表示唯一设定权限
    - `r`, `w`, `x`详情见[下方](/命令行/权限/#访问权限控制组)

    其他参数说明: 

    - `-c`: 显示权限并更的资料
    - `-f`: 若该文件权限无法更改, 不要显示错误信息
    - `-v`: 显示权限并更的详细资料
    - `-R`: 以递归的方式变更

=== "`chown`"

    **语法**:

    **参数说明**:

=== "`chgrp`"

    **语法**:

    **参数说明**:

## 安全模型

Linux系统上最初的安全模型为DAC, Discretionary Access Control. 后来又增加了一个新的安全模型为MAC, Mandatory Access Control. 

DAC和MAC不是互斥的, DAC是最基本的安全模型, 是我们最常用到的访问控制机制, 而MAC是构建在DAC之上的可选的加强安全机制. 访问前, Linux系统通常都是先做DAC检查, 如果没有通过则操作直接失败; 如果通过DAC检查并且系统支持MAC模块, 再做MAC权限检查.

为了区分两者, 我们将支持MAC的Linux系统称为SELinux, 表示它是针对Linux的安全加强系统. 

### DAC安全模型

DAC安全模型的核心内容是: 进程理论上所拥有的权限和执行它的用户的权限相同. 

#### 用户、组、口令信息

通过`/etc/passwd`和`/etc/group`保存用户和组信息, 通过`/etc/shadow`保存密码口令及其变动信息, 每行一条记录. 

用户和组分别用UID和GID表示, 一个用户可以同时属于多个组, 默认每个用户必须属于一个与之UID同值的GID. 

##### `/etc/passwd`

|0|1|2|3|4|5|6|
|-|-|-|-|-|-|-|
|用户名|口令|UID|GID|注释|用户目录|默认shell|

##### `/etc/group`

|0|1|2|3|
|-|-|-|-|
|组名|口令|GID|组成员用户列表|

##### `/etc/shadow`

|0|1|2|3|4|5|
|-|-|-|-|-|-|
|登录名|最后一次修改时间|最小时间间隔|最大时间间隔|警告时间|不活动时间|

#### 文件权限控制(传统)

##### 文件类型

- 普通文件(`-`), 包括文本文件和二进制文件, 可以用`touch`创建
- 目录文件(`d`)
- [套接字文件](https://zh.wikipedia.org/zh-hans/%E7%B6%B2%E8%B7%AF%E6%8F%92%E5%BA%A7)(`s`), 用于进程间通信(可以跨网络), 一般由应用程序在执行中间创建
- [管道文件](https://blog.csdn.net/shui2104/article/details/121954184)(`p`), 也用于进程之间的通信, 一般分为无名管道(有亲缘关系的进程通信)和有名管道(无亲缘关系的进程通信), 可以用`mkfifo`创建
- 字符文件(`c`)和块文件(`b`), 均为设备文件, 可以用`mknod`创建
- 链接文件(`l`), 是软链接文件, 而不是硬连接文件

##### 访问权限控制组 {#访问权限控制组}

分为三组进行控制: user包含对文件属主设定的权限, group包含对文件属组设定的权限, others包含对其他者设定的权限. 可设定的权限为: 

- `r`: 表示具有读权限
- `w`: 表示具有写权限
- `x`: 表示具有执行/搜索权限, 一般针对可执行文件/目录
- `s`: 表示用户在执行该文件时, 将临时拥有属主/属组的权限, 一般针对可执行文件/目录
- `t`: 表示只有目录的所有者才能删除或者重命名该目录下的文件, 一般针对目录

此外, 权限还可以用个数字来表示, 这些数字表示每种权限的组合, 每个权限都有对应的数值:

- `r`: 4
- `w`: 2
- `x`: 1
- `s`: 4
- `t`: 1

数字结构通常分为4部分:

1. 特殊权限位
    - 属主`s`: 4
    - 属组`s`: 2
    - `t`: 1
2. 所有者权限位
3. 所属组权限位
4. 其他用户权限位

??? example "例子"

    1. 组合`rwxrwxrwt`: 
        - 特殊权限: `t` = 1
        - 所有者权限: `rwx` = 7
        - 组权限: `rwx` = 7
        - 其他用户权限: `rwt` = 7
        所以可以表示为1777
    2. 组合`rwsr-xr-x`: 
        - 特殊权限: 属主`s` = 4
        - 所有者权限: `rws` = 7
        - 组权限: `r-x` = 5
        - 其他用户权限: `r-x` = 5
        所以可以表示为4755
    3. 组合`rwsrwsr-t`: 
        - 特殊权限: 属主`s` + 属组`s` + `t` = 7
        - 所有者权限: `rws` = 7
        - 组权限: `rws` = 7
        - 其他用户权限: `r-t` = 5
        所以可以表示为7775

#### 文件权限控制(ACL)

##### ACL是什么

访问控制列表(Access Control List, ACL)是由一条或者多条规则组成的集合, 它在各种系统和应用中都有广泛的应用, 通过灵活使用ACL, 可以实现细粒度的访问控制, 比如说:

1. 文件系统: 最常见的ACL应用场景
2. 网络设备: 在路由器或者交换机中, ACL用于控制流量如定义允许或者拒绝特定IP地址或网络段的访问规则
3. 数据库系统: 用于管理用户对数据库对象的访问权限
4. Web: 控制用户对特定API端点的访问权限
5. 云计算和虚拟环境: 用于控制对虚拟机, 存储资源和网络资源的访问权限
6. VCS: 用于控制用户对代码库的访问权限
7. ...

##### 为什么需要ACL

1. 更细粒度的控制: 可以为不同的用户和组设置不同的权限
2. 继承: 目录的ACL可以配置为自动应用到新创建的文件和子目录

[^1]: Jang, M., & Orsaria, A. (2016). RHCSA/RHCE Red Hat Linux Certification Study Guide, Seventh Edition (7th edition). McGraw Hill.
[^2]: "262588213843476". (n.d.). Linux权限控制的基本原理. Gist. Retrieved June 9, 2024, from https://gist.github.com/baymaxium/45ad3b68bcd392c3c3feebf935f1618f
[^3]: Linux chmod 命令 | 菜鸟教程. (n.d.). Retrieved June 11, 2024, from https://www.runoob.com/linux/linux-comm-chmod.html